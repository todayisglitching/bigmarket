# Сводка обновлений

## Что было добавлено

### 1. Поля в модель Product
- ✅ **price** (DecimalField) - цена продукта в рублях
  - Тип: DecimalField с max_digits=10, decimal_places=2
  - По умолчанию: 0.00
  - Валидация: минимум 0 (не может быть отрицательной)
  - Обязательное поле при создании продукта
  
- ✅ **stock** (PositiveIntegerField) - количество товара на складе
  - Тип: PositiveIntegerField
  - По умолчанию: 0
  - Валидация: автоматически проверяет, что значение >= 0
  - Обязательное поле при создании продукта

### 2. Зашифрованные пароли
- ✅ Пароли автоматически хешируются через Django's `set_password()` метод
- ✅ Используется безопасный алгоритм хеширования (PBKDF2 по умолчанию)
- ✅ Пароли никогда не хранятся в открытом виде

### 3. Веб-формы для клиентов
- ✅ **Регистрация клиента** (`/auth/client/register/`)
  - Форма с валидацией
  - Проверка уникальности email
  - Проверка совпадения паролей
  - Автоматическое хеширование пароля
  - Генерация токена
  
- ✅ **Вход для клиента** (`/auth/client/login/`)
  - Проверка пароля через `check_password()`
  - Сохранение токена в сессии
  - Отображение токена после входа

### 4. Веб-форма для продавцов
- ✅ **Вход для продавца** (`/auth/seller/login/`)
  - Проверка пароля
  - Сохранение токена в сессии
  - Отображение токена после входа
  - **Примечание:** Регистрация продавцов только через БД/админку

### 5. Обновленная навигация
- ✅ Показ статуса входа (клиент/продавец)
- ✅ Ссылки на вход/выход
- ✅ Кнопка регистрации для клиентов

### 6. Обновленные шаблоны
- ✅ Отображение цены и остатка на главной странице
- ✅ Отображение цены и остатка на странице продукта
- ✅ Индикация наличия/отсутствия товара

## Файлы, которые были созданы/изменены

### Новые файлы:
- `marketplace/forms.py` - Django формы для регистрации и входа
- `marketplace/auth_views.py` - представления для веб-форм аутентификации
- `marketplace/templates/marketplace/auth/client_register.html` - шаблон регистрации
- `marketplace/templates/marketplace/auth/client_login.html` - шаблон входа клиента
- `marketplace/templates/marketplace/auth/seller_login.html` - шаблон входа продавца

### Измененные файлы:
- `marketplace/models.py` - добавлены поля price и stock в Product
- `marketplace/serializers.py` - обновлены сериализаторы для Product
- `marketplace/urls.py` - добавлены маршруты для веб-форм
- `marketplace/templates/marketplace/base.html` - обновлена навигация
- `marketplace/templates/marketplace/home.html` - отображение price и stock
- `marketplace/templates/marketplace/product_detail.html` - отображение price и stock

## URL маршруты

### Веб-формы:
- `/auth/client/register/` - Регистрация клиента
- `/auth/client/login/` - Вход для клиента
- `/auth/seller/login/` - Вход для продавца
- `/auth/logout/` - Выход из системы

### API (без изменений):
- `/api/auth/client/register/` - Регистрация клиента через API
- `/api/auth/seller/register/` - Регистрация продавца через API (не рекомендуется, используйте админку)

## Безопасность паролей

### Как работает хеширование:
1. При регистрации вызывается `client.set_password(password)` или `seller.set_password(password)`
2. Django автоматически хеширует пароль используя PBKDF2 алгоритм
3. В базе данных хранится только хеш, никогда не хранится открытый пароль
4. При входе используется `check_password()` для сравнения хешей

### Пример:
```python
# При регистрации
client = Client.objects.create(email='test@example.com', ...)
client.set_password('my_password')  # Пароль хешируется
client.save()

# При входе
client = Client.objects.get(email='test@example.com')
if client.check_password('my_password'):  # Сравнение хешей
    # Вход успешен
```

## Регистрация продавцов

**Важно:** Продавцы регистрируются только через:
1. Админ-панель Django (`/admin/`)
2. Прямое создание в базе данных
3. API эндпоинт оставлен для совместимости, но не рекомендуется

## Следующие шаги

1. **Создайте миграции:**
   ```bash
   python manage.py makemigrations marketplace
   ```

2. **Примените миграции:**
   ```bash
   python manage.py migrate
   ```

3. **Создайте продавца через админку:**
   - Зайдите в `/admin/`
   - Создайте нового продавца
   - Установите пароль (он будет автоматически захеширован)

4. **Протестируйте регистрацию клиента:**
   - Перейдите на `/auth/client/register/`
   - Заполните форму
   - После регистрации вы будете перенаправлены на страницу входа

5. **Протестируйте вход:**
   - Клиенты: `/auth/client/login/`
   - Продавцы: `/auth/seller/login/`

## Примечания

- Все пароли зашифрованы через Django's password hashing
- Токены генерируются автоматически при создании пользователя
- Сессии используются для веб-интерфейса
- API использует токен-аутентификацию
- Поле `checked` у продуктов может быть изменено только администратором
