# Инструкция по настройке

## 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

## 2. Обновление настроек Django

Откройте `backend/settings.py` и добавьте настройки из файла `SETTINGS_UPDATE.md`.

Основные изменения:
- Добавить `rest_framework` в `INSTALLED_APPS`
- Добавить настройки `REST_FRAMEWORK`
- Добавить настройки для медиа-файлов (`MEDIA_URL`, `MEDIA_ROOT`)

## 3. Создание миграций

```bash
python manage.py makemigrations marketplace
```

## 4. Применение миграций

```bash
python manage.py migrate
```

## 5. Создание суперпользователя (для доступа к админке)

```bash
python manage.py createsuperuser
```

**Важно:** Суперпользователь создается через стандартную систему Django. Для работы с моделями Seller и Client используйте админ-панель.

## 6. Запуск сервера

```bash
python manage.py runserver
```

## 7. Доступ к админ-панели

Откройте в браузере: `http://localhost:8000/admin/`

В админ-панели вы можете:
- Управлять тегами (с отображением количества продуктов)
- Управлять продавцами и клиентами (с отображением количества продуктов для продавцов)
- Управлять продуктами (с полями price и stock)
- **Изменять поле `checked` у продуктов** (только администратор может это делать)
- Регенерировать токены для продавцов и клиентов

## 8. Тестирование API

Используйте Postman, curl или любой другой HTTP-клиент для тестирования API.

Примеры запросов находятся в файле `API_DOCUMENTATION.md`.

## Структура проекта

```
marketplace/
├── models.py          # Модели: Product, Tag, Seller, Client
├── serializers.py     # Сериализаторы для API
├── api_views.py       # API представления
├── views.py           # Веб-представления (обновлены, используют модели)
├── authentication.py  # Кастомная токен-аутентификация
├── permissions.py     # Кастомные права доступа
├── admin.py           # Настройки админ-панели
└── urls.py            # URL маршруты
```

## Безопасность

### Реализованные меры безопасности:

1. **Токен-аутентификация** - каждый пользователь получает уникальный токен
2. **Хеширование паролей** - Django автоматически хеширует пароли
3. **Валидация данных** - все входные данные проверяются
4. **Права доступа** - разные уровни доступа для разных типов пользователей
5. **Защита от SQL-инъекций** - использование ORM Django
6. **CSRF защита** - включена для веб-интерфейса
7. **Поле checked** - может быть изменено только администратором

### Рекомендации для production:

1. Используйте переменные окружения для `SECRET_KEY`
2. Установите `DEBUG = False`
3. Настройте `ALLOWED_HOSTS`
4. Используйте HTTPS
5. Настройте CORS правильно
6. Используйте PostgreSQL вместо SQLite
7. Настройте логирование
8. Используйте rate limiting для API

## Основные функции

### Для продавцов:
- Регистрация через админ-панель (с получением токена)
- Создание продуктов с указанием цены и остатка (checked=False по умолчанию)
- Редактирование своих продуктов
- Просмотр своих продуктов
- Обновление профиля

### Для клиентов:
- Регистрация с получением токена
- Просмотр проверенных продуктов
- Обновление профиля

### Для администраторов:
- Полный доступ через админ-панель
- Изменение поля `checked` у продуктов
- Управление всеми пользователями
- Регенерация токенов

## Решение проблем

### Ошибка: "No module named 'rest_framework'"
Решение: Установите зависимости: `pip install -r requirements.txt`

### Ошибка: "Table doesn't exist"
Решение: Примените миграции: `python manage.py migrate`

### Ошибка при загрузке изображений
Решение: Убедитесь, что в `settings.py` настроены `MEDIA_URL` и `MEDIA_ROOT`, и создана папка `media/`

### Токен не работает
Решение: Проверьте, что токен передается в заголовке: `Authorization: Token <token>`
